{% if type == 'text' %}
<div id="textInputSection" 
     hx-ext="response-targets"
     x-data="{ errorMsg: '', showError: false }">
    <label for="resume" class="block text-gray-700 dark:text-gray-300 font-semibold mb-2">Resume (Markdown)</label>
    <textarea id="resume" name="resume" 
              class="w-full px-3 py-2 text-gray-700 bg-white dark:bg-gray-700 
                     border border-gray-300 dark:border-gray-600 rounded-md 
                     dark:text-white focus:outline-none focus:ring-2 
                     focus:ring-accent-light" 
              rows="10"></textarea>
    
    <!-- Error message for textarea -->
    <div x-show="showError" 
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0 transform scale-95"
         x-transition:enter-end="opacity-100 transform scale-100"
         class="mt-2 text-red-600 dark:text-red-400 text-sm">
        <span x-text="errorMsg"></span>
    </div>
</div>
{% else %}
<div id="fileInputSection"
     hx-ext="response-targets retry"
     x-data="{ 
        errorMsg: '', 
        showError: false,
        fileName: '',
        fileSize: '',
        isUploading: false,
        uploadProgress: 0,
        
        handleFileChange(event) {
            const file = event.target.files[0];
            if (file) {
                this.fileName = file.name;
                this.fileSize = (file.size / 1024).toFixed(1) + 'KB';
                this.showError = false;
                
                // Validate file
                const maxSize = 5 * 1024 * 1024; // 5MB
                if (file.size > maxSize) {
                    this.errorMsg = 'File size exceeds 5MB limit';
                    this.showError = true;
                    event.target.value = '';
                    this.fileName = '';
                    this.fileSize = '';
                }
            } else {
                this.fileName = '';
                this.fileSize = '';
            }
        },
        
        uploadStart() {
            this.isUploading = true;
            this.uploadProgress = 0;
        },
        
        uploadProgress(event) {
            if (event.detail.loaded && event.detail.total) {
                this.uploadProgress = Math.round((event.detail.loaded / event.detail.total) * 100);
            }
        },
        
        uploadComplete() {
            this.isUploading = false;
            this.uploadProgress = 100;
        },
        
        uploadError(event) {
            this.isUploading = false;
            this.showError = true;
            try {
                if (event.detail.xhr && event.detail.xhr.responseText) {
                    const response = JSON.parse(event.detail.xhr.responseText);
                    this.errorMsg = response.error || 'Upload failed';
                } else {
                    this.errorMsg = 'Upload failed';
                }
            } catch(e) {
                this.errorMsg = 'Upload failed';
            }
        }
     }"
     @htmx:beforeRequest="uploadStart()"
     @htmx:xhr:progress="uploadProgress($event)"
     @htmx:afterRequest="uploadComplete()"
     @htmx:xhr:error="uploadError($event)">
    
    <label for="resume_file" class="block text-gray-700 dark:text-gray-300 font-semibold mb-2">Resume File</label>
    
    <div class="flex items-center space-x-3">
        <input type="file" 
               class="block w-full text-gray-700 dark:text-gray-300 
                      file:mr-4 file:py-2 file:px-4
                      file:rounded-md file:border-0
                      file:text-sm file:font-semibold
                      file:bg-accent-light file:text-gray-900
                      hover:file:bg-accent-dark" 
               id="resume_file" name="resume_file" accept=".pdf,.docx,.md"
               @change="handleFileChange($event)"
               hx-target-400="#file-validation-error"
               hx-target-500="#file-server-error"
               hx-retry="3"
               hx-retry-delay="2000">
        
        <!-- Upload progress indicator -->
        <div x-show="isUploading" class="flex items-center">
            <div class="w-20 bg-gray-200 dark:bg-gray-700 rounded-full h-2.5 mr-2">
                <div class="bg-accent-dark h-2.5 rounded-full" 
                     :style="`width: ${uploadProgress}%`"></div>
            </div>
            <span class="text-sm text-gray-600 dark:text-gray-400" x-text="`${uploadProgress}%`"></span>
        </div>
    </div>
    
    <!-- File info display -->
    <div x-show="fileName !== ''" class="mt-2 text-sm text-gray-600 dark:text-gray-400">
        Selected: <span x-text="fileName"></span> (<span x-text="fileSize"></span>)
    </div>
    
    <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">Maximum file size: 5MB</p>
    
    <!-- Error message area -->
    <div id="file-validation-error" 
         x-show="showError" 
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0 transform scale-95"
         x-transition:enter-end="opacity-100 transform scale-100"
         class="mt-2 text-red-600 dark:text-red-400 text-sm">
        <span x-text="errorMsg"></span>
    </div>
    
    <!-- Server error container (hidden by default) -->
    <div id="file-server-error" class="hidden">
        <!-- Will be populated by server error responses -->
    </div>
</div>
{% endif %}