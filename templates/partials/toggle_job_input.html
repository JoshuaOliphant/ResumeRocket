{% if type == 'text' %}
<div id="jobTextSection"
     hx-ext="response-targets"
     x-data="{ errorMsg: '', showError: false }">
    <label for="jobDescription" class="block text-gray-700 dark:text-gray-300 font-semibold mb-2">Job Description</label>
    <textarea id="jobDescription" name="job_description" 
              class="w-full px-3 py-2 text-gray-700 bg-white dark:bg-gray-700 
                     border border-gray-300 dark:border-gray-600 rounded-md 
                     dark:text-white focus:outline-none focus:ring-2 
                     focus:ring-accent-light" 
              rows="5"
              hx-target-400="#job-validation-error"
              @htmx:xhr:error="showError = true; errorMsg = 'Please provide a valid job description'"></textarea>
              
    <!-- Error message for textarea -->
    <div id="job-validation-error"
         x-show="showError" 
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0 transform scale-95"
         x-transition:enter-end="opacity-100 transform scale-100"
         class="mt-2 text-red-600 dark:text-red-400 text-sm">
        <span x-text="errorMsg"></span>
    </div>
</div>
{% else %}
<div id="jobUrlSection"
     hx-ext="response-targets retry fallback"
     x-data="{ 
        errorMsg: '', 
        showError: false,
        isLoading: false,
        
        validateUrl(event) {
            const url = event.target.value;
            this.showError = false;
            
            if (url && !url.startsWith('http')) {
                this.errorMsg = 'URL must start with http:// or https://';
                this.showError = true;
            }
        },
        
        startLoading() {
            this.isLoading = true;
        },
        
        stopLoading() {
            this.isLoading = false;
        },
        
        handleError(event) {
            this.isLoading = false;
            this.showError = true;
            
            try {
                if (event.detail.xhr && event.detail.xhr.responseText) {
                    const response = JSON.parse(event.detail.xhr.responseText);
                    this.errorMsg = response.error || 'URL could not be processed';
                } else {
                    this.errorMsg = 'Error processing job URL';
                }
            } catch(e) {
                this.errorMsg = 'Error processing job URL';
            }
        }
     }"
     @htmx:beforeRequest="startLoading()"
     @htmx:afterRequest="stopLoading()"
     @htmx:xhr:error="handleError($event)">
    
    <label for="jobUrl" class="block text-gray-700 dark:text-gray-300 font-semibold mb-2">Job Posting URL</label>
    
    <div class="relative">
        <input class="w-full px-3 py-2 border rounded-md 
                      text-gray-700 bg-white dark:bg-gray-700 
                      border-gray-300 dark:border-gray-600
                      dark:text-white focus:outline-none 
                      focus:ring-2 focus:ring-accent-light pr-10" 
               id="jobUrl" name="job_url" placeholder="https://..."
               @input="validateUrl($event)"
               hx-target-400="#job-url-error"
               hx-target-500="#job-server-error"
               hx-target-404="#job-not-found"
               hx-fallback="#job-url-fallback"
               hx-retry="2"
               hx-retry-delay="1500">
               
        <!-- Loading spinner -->
        <div x-show="isLoading" class="absolute inset-y-0 right-0 flex items-center pr-3">
            <svg class="animate-spin h-5 w-5 text-accent-dark" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
        </div>
    </div>
    
    <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">Enter the full URL of the job posting (including https://)</p>
    
    <!-- Validation error -->
    <div id="job-url-error"
         x-show="showError" 
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0 transform scale-95"
         x-transition:enter-end="opacity-100 transform scale-100"
         class="mt-2 text-red-600 dark:text-red-400 text-sm">
        <span x-text="errorMsg"></span>
    </div>
    
    <!-- Not found error template -->
    <div id="job-not-found" class="hidden">
        <div class="mt-2 text-amber-600 dark:text-amber-400 text-sm">
            The job posting couldn't be found. Please check the URL and try again, or paste the job description directly.
        </div>
    </div>
    
    <!-- Server error template -->
    <div id="job-server-error" class="hidden">
        <div class="mt-2 text-red-600 dark:text-red-400 text-sm">
            There was a problem processing this job URL. Please try pasting the job description directly.
        </div>
    </div>
    
    <!-- Fallback template -->
    <div id="job-url-fallback" class="hidden">
        <div class="mt-2 text-amber-600 dark:text-amber-400 text-sm">
            <p>We're having trouble accessing this job posting right now.</p>
            <button type="button" 
                    data-retry="true"
                    class="mt-1 text-accent-dark dark:text-accent-light hover:underline">
                Try again
            </button>
            <span class="text-sm text-gray-500"> or paste the job description directly</span>
        </div>
    </div>
</div>
{% endif %}